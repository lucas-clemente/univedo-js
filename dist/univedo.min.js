(function(){(function(t){var e,r,n,s,i,a,o,u,c,h,f,l;for(o=[],c={},h=l=0;255>=l;h=++l)o[h]=(h+256).toString(16).substr(1),c[o[h]]=h;return f=function(t){return h=0,o[t[h++]]+o[t[h++]]+o[t[h++]]+o[t[h++]]+"-"+o[t[h++]]+o[t[h++]]+"-"+o[t[h++]]+o[t[h++]]+"-"+o[t[h++]]+o[t[h++]]+"-"+o[t[h++]]+o[t[h++]]+o[t[h++]]+o[t[h++]]+o[t[h++]]+o[t[h++]]},a=function(t){var e,r,n,s;for(e=new ArrayBuffer(t.length),r=new Uint8Array(e),h=n=0,s=t.length-1;s>=0?s>=n:n>=s;h=s>=0?++n:--n)r[h]=t.charCodeAt(h);return e},i=function(t){return a(String.fromCharCode.apply(null,t))},u=function(t,e){var r;return r=new Uint8Array(t.byteLength+e.byteLength),r.set(new Uint8Array(t),0),r.set(new Uint8Array(e),t.byteLength),r.buffer},r={UINT:0,NEGINT:1,BYTESTRING:2,TEXTSTRING:3,ARRAY:4,MAP:5,TAG:6,SIMPLE:7},s={DECIMAL:4,REMOTEOBJECT:6,UUID:7,TIME:8,DATETIME:9,SQL:10},n={FALSE:20,TRUE:21,NULL:22,FLOAT32:26,FLOAT64:27},t.Message=e=function(){function t(t){this.buffer=t,this.offset=0}return t.prototype.getDataView=function(t){var e;return e=new DataView(this.buffer,this.offset,t),this.offset+=t,e},t.prototype.getLen=function(t){var e;switch(e=31&t){case 24:return this.getDataView(1).getUint8(0);case 25:return this.getDataView(2).getUint16(0);case 26:return this.getDataView(4).getUint32(0);case 27:throw"int64 not yet supported in javascript!";default:return e}},t.prototype.read=function(){var t,e,i,a,o,u,c,l,p,T;switch(o=this.getDataView(1).getUint8(0),e=o>>5){case r.UINT:return this.getLen(o);case r.NEGINT:return-this.getLen(o)-1;case r.SIMPLE:switch(31&o){case n.FALSE:return!1;case n.TRUE:return!0;case n.NULL:return null;case n.FLOAT32:return this.getDataView(4).getFloat32(0);case n.FLOAT64:return this.getDataView(8).getFloat64(0);default:throw"invalid simple in cbor protocol"}break;case r.BYTESTRING:return t=this.getLen(o),this.buffer.slice(this.offset,this.offset+=t);case r.TEXTSTRING:return t=this.getLen(o),String.fromCharCode.apply(null,new Uint8Array(this.buffer.slice(this.offset,this.offset+=t)));case r.ARRAY:for(t=this.getLen(o),T=[],h=u=0,l=t-1;l>=0?l>=u:u>=l;h=l>=0?++u:--u)T.push(this.read());return T;case r.MAP:for(t=this.getLen(o),i={},h=c=0,p=t-1;p>=0?p>=c:c>=p;h=p>=0?++c:--c)i[this.read()]=this.read();return i;case r.TAG:switch(a=this.getLen(o)){case s.TIME:case s.DATETIME:return new Date(this.read());case s.UUID:return f(this.read());default:throw"invalid tag in cbor protocol"}break;default:throw"invalid major in cbor protocol"}},t.prototype.sendSimple=function(t){return i([r.SIMPLE<<5|t])},t.prototype.sendTag=function(t){return i([r.TAG<<5|t])},t.prototype.sendLen=function(t,e){var r;switch(r=t<<5,!1){case!(23>=e):return i([r|e]);case!(256>e):return i([24|r,e]);case!(65536>e):return i([25|r,e>>8,255&e]);case!(4294967296>e):return i([26|r,e>>24,e>>16,e>>8,255&e]);default:throw"sendLen() called with non-uint"}},t.prototype.sendImpl=function(t){var e;switch(!1){case null!==t:return this.sendSimple(n.NULL);case t!==!0:return this.sendSimple(n.TRUE);case t!==!1:return this.sendSimple(n.FALSE);case"number"!=typeof t:switch(!1){case!(t>=0&&4294967296>t&&0===t%1):return this.sendLen(r.UINT,t);case!(0>t&&t>=-4294967296&&0===t%1):return this.sendLen(r.NEGINT,-t-1);default:return e=new ArrayBuffer(8),new DataView(e).setFloat64(0,t),u(this.sendSimple(n.FLOAT64),e)}break;case"string"!=typeof t:return u(this.sendLen(r.TEXTSTRING,t.length),a(t));case"ArrayBuffer"!==t.constructor.name:return u(this.sendLen(r.BYTESTRING,t.byteLength),t);default:throw"unsupported object in cbor protocol"}},t}(),null})("undefined"!=typeof exports&&null!==exports?exports:this)}).call(this);