!function(a){var b,c,d,e,f,g,h,i,j,k,l,m;for(h=[],j={},k=m=0;255>=m;k=++m)h[k]=(k+256).toString(16).substr(1),j[h[k]]=k;l=function(a){return k=0,h[a[k++]]+h[a[k++]]+h[a[k++]]+h[a[k++]]+"-"+h[a[k++]]+h[a[k++]]+"-"+h[a[k++]]+h[a[k++]]+"-"+h[a[k++]]+h[a[k++]]+"-"+h[a[k++]]+h[a[k++]]+h[a[k++]]+h[a[k++]]+h[a[k++]]+h[a[k++]]},g=function(a){var b,c,d,e;for(b=new ArrayBuffer(a.length),c=new Uint8Array(b),k=d=0,e=a.length-1;e>=0?e>=d:d>=e;k=e>=0?++d:--d)c[k]=a.charCodeAt(k);return b},f=function(a){return g(String.fromCharCode.apply(null,a))},i=function(a){var b,c,d,e,f,g,h,i;for(e=0,f=0,h=a.length;h>f;f++)b=a[f],e+=b.byteLength;for(d=new Uint8Array(e),c=0,g=0,i=a.length;i>g;g++)b=a[g],d.set(new Uint8Array(b),c),c+=b.byteLength;return d.buffer},b={UINT:0,NEGINT:1,BYTESTRING:2,TEXTSTRING:3,ARRAY:4,MAP:5,TAG:6,SIMPLE:7},d={DATETIME:0,TIME:1,DECIMAL:4,REMOTEOBJECT:6,UUID:7,SQL:10},c={FALSE:20,TRUE:21,NULL:22,FLOAT32:26,FLOAT64:27},a.Message=e=function(){function a(a){this.buffer=a,this.offset=0}return a.prototype.getDataView=function(a){var b;return b=new DataView(this.buffer,this.offset,a),this.offset+=a,b},a.prototype.getLen=function(a){var b;switch(b=31&a){case 24:return this.getDataView(1).getUint8(0);case 25:return this.getDataView(2).getUint16(0);case 26:return this.getDataView(4).getUint32(0);case 27:throw"int64 not yet supported in javascript!";default:return b}},a.prototype.read=function(){var a,e,f,g,h,i,j,m,n,o;switch(h=this.getDataView(1).getUint8(0),e=h>>5){case b.UINT:return this.getLen(h);case b.NEGINT:return-this.getLen(h)-1;case b.SIMPLE:switch(31&h){case c.FALSE:return!1;case c.TRUE:return!0;case c.NULL:return null;case c.FLOAT32:return this.getDataView(4).getFloat32(0);case c.FLOAT64:return this.getDataView(8).getFloat64(0);default:throw"invalid simple in cbor protocol"}break;case b.BYTESTRING:return a=this.getLen(h),this.buffer.slice(this.offset,this.offset+=a);case b.TEXTSTRING:return a=this.getLen(h),String.fromCharCode.apply(null,new Uint8Array(this.buffer.slice(this.offset,this.offset+=a)));case b.ARRAY:for(a=this.getLen(h),o=[],k=i=0,m=a-1;m>=0?m>=i:i>=m;k=m>=0?++i:--i)o.push(this.read());return o;case b.MAP:for(a=this.getLen(h),f={},k=j=0,n=a-1;n>=0?n>=j:j>=n;k=n>=0?++j:--j)f[this.read()]=this.read();return f;case b.TAG:switch(g=this.getLen(h)){case d.DATETIME:return new Date(this.read());case d.TIME:return new Date(this.read());case d.UUID:return l(this.read());default:throw"invalid tag in cbor protocol"}break;default:throw"invalid major in cbor protocol"}},a.prototype.sendSimple=function(a){return f([b.SIMPLE<<5|a])},a.prototype.sendTag=function(a){return f([b.TAG<<5|a])},a.prototype.sendLen=function(a,b){var c;switch(c=a<<5,!1){case!(23>=b):return f([c|b]);case!(256>b):return f([24|c,b]);case!(65536>b):return f([25|c,b>>8,255&b]);case!(4294967296>b):return f([26|c,b>>24,b>>16,b>>8,255&b]);default:throw"sendLen() called with non-uint"}},a.prototype.sendImpl=function(a){var e,f,h,j,k,l,m,n,o;switch(!1){case null!==a:return this.sendSimple(c.NULL);case a!==!0:return this.sendSimple(c.TRUE);case a!==!1:return this.sendSimple(c.FALSE);case"number"!=typeof a:switch(!1){case!(a>=0&&4294967296>a&&a%1===0):return this.sendLen(b.UINT,a);case!(0>a&&a>=-4294967296&&a%1===0):return this.sendLen(b.NEGINT,-a-1);default:return e=new ArrayBuffer(8),new DataView(e).setFloat64(0,a),i([this.sendSimple(c.FLOAT64),e])}break;case"string"!=typeof a:return i([this.sendLen(b.TEXTSTRING,a.length),g(a)]);case"ArrayBuffer"!==a.constructor.name:return i([this.sendLen(b.BYTESTRING,a.byteLength),a]);case"Array"!==a.constructor.name:for(f=[this.sendLen(b.ARRAY,a.length)],l=0,n=a.length;n>l;l++)k=a[l],f.push(this.sendImpl(k));return i(f);case"Object"!==a.constructor.name:for(j=Object.keys(a),f=[this.sendLen(b.MAP,j.length)],m=0,o=j.length;o>m;m++)h=j[m],f.push(this.sendImpl(h)),f.push(this.sendImpl(a[h]));return i(f);case"Date"!==a.constructor.name:return i([this.sendTag(d.DATETIME),this.sendImpl(a.toISOString())]);default:throw"unsupported object in cbor protocol"}},a}()}("undefined"!=typeof exports&&null!==exports?exports:this);