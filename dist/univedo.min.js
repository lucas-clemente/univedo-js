(function(){(function(e){var t,r,n,s,i,a,o,u,c,h,f,l;for(o=[],c={},h=l=0;255>=l;h=++l)o[h]=(h+256).toString(16).substr(1),c[o[h]]=h;return f=function(e){return h=0,o[e[h++]]+o[e[h++]]+o[e[h++]]+o[e[h++]]+"-"+o[e[h++]]+o[e[h++]]+"-"+o[e[h++]]+o[e[h++]]+"-"+o[e[h++]]+o[e[h++]]+"-"+o[e[h++]]+o[e[h++]]+o[e[h++]]+o[e[h++]]+o[e[h++]]+o[e[h++]]},a=function(e){var t,r,n,s;for(t=new ArrayBuffer(e.length),r=new Uint8Array(t),h=n=0,s=e.length-1;s>=0?s>=n:n>=s;h=s>=0?++n:--n)r[h]=e.charCodeAt(h);return t},i=function(e){return a(String.fromCharCode.apply(null,e))},u=function(e){var t,r,n,s,i,a,o,u;for(s=0,i=0,o=e.length;o>i;i++)t=e[i],s+=t.byteLength;for(n=new Uint8Array(s),r=0,a=0,u=e.length;u>a;a++)t=e[a],n.set(new Uint8Array(t),r),r+=t.byteLength;return n.buffer},t={UINT:0,NEGINT:1,BYTESTRING:2,TEXTSTRING:3,ARRAY:4,MAP:5,TAG:6,SIMPLE:7},n={DECIMAL:4,REMOTEOBJECT:6,UUID:7,TIME:8,DATETIME:9,SQL:10},r={FALSE:20,TRUE:21,NULL:22,FLOAT32:26,FLOAT64:27},e.Message=s=function(){function e(e){this.buffer=e,this.offset=0}return e.prototype.getDataView=function(e){var t;return t=new DataView(this.buffer,this.offset,e),this.offset+=e,t},e.prototype.getLen=function(e){var t;switch(t=31&e){case 24:return this.getDataView(1).getUint8(0);case 25:return this.getDataView(2).getUint16(0);case 26:return this.getDataView(4).getUint32(0);case 27:throw"int64 not yet supported in javascript!";default:return t}},e.prototype.read=function(){var e,s,i,a,o,u,c,l,p,d;switch(o=this.getDataView(1).getUint8(0),s=o>>5){case t.UINT:return this.getLen(o);case t.NEGINT:return-this.getLen(o)-1;case t.SIMPLE:switch(31&o){case r.FALSE:return!1;case r.TRUE:return!0;case r.NULL:return null;case r.FLOAT32:return this.getDataView(4).getFloat32(0);case r.FLOAT64:return this.getDataView(8).getFloat64(0);default:throw"invalid simple in cbor protocol"}break;case t.BYTESTRING:return e=this.getLen(o),this.buffer.slice(this.offset,this.offset+=e);case t.TEXTSTRING:return e=this.getLen(o),String.fromCharCode.apply(null,new Uint8Array(this.buffer.slice(this.offset,this.offset+=e)));case t.ARRAY:for(e=this.getLen(o),d=[],h=u=0,l=e-1;l>=0?l>=u:u>=l;h=l>=0?++u:--u)d.push(this.read());return d;case t.MAP:for(e=this.getLen(o),i={},h=c=0,p=e-1;p>=0?p>=c:c>=p;h=p>=0?++c:--c)i[this.read()]=this.read();return i;case t.TAG:switch(a=this.getLen(o)){case n.TIME:case n.DATETIME:return new Date(this.read());case n.UUID:return f(this.read());default:throw"invalid tag in cbor protocol"}break;default:throw"invalid major in cbor protocol"}},e.prototype.sendSimple=function(e){return i([t.SIMPLE<<5|e])},e.prototype.sendTag=function(e){return i([t.TAG<<5|e])},e.prototype.sendLen=function(e,t){var r;switch(r=e<<5,!1){case!(23>=t):return i([r|t]);case!(256>t):return i([24|r,t]);case!(65536>t):return i([25|r,t>>8,255&t]);case!(4294967296>t):return i([26|r,t>>24,t>>16,t>>8,255&t]);default:throw"sendLen() called with non-uint"}},e.prototype.sendImpl=function(e){var n,s,i,o,c,h,f,l,p;switch(!1){case null!==e:return this.sendSimple(r.NULL);case e!==!0:return this.sendSimple(r.TRUE);case e!==!1:return this.sendSimple(r.FALSE);case"number"!=typeof e:switch(!1){case!(e>=0&&4294967296>e&&0===e%1):return this.sendLen(t.UINT,e);case!(0>e&&e>=-4294967296&&0===e%1):return this.sendLen(t.NEGINT,-e-1);default:return n=new ArrayBuffer(8),new DataView(n).setFloat64(0,e),u([this.sendSimple(r.FLOAT64),n])}break;case"string"!=typeof e:return u([this.sendLen(t.TEXTSTRING,e.length),a(e)]);case"ArrayBuffer"!==e.constructor.name:return u([this.sendLen(t.BYTESTRING,e.byteLength),e]);case"Array"!==e.constructor.name:for(s=[this.sendLen(t.ARRAY,e.length)],h=0,l=e.length;l>h;h++)c=e[h],s.push(this.sendImpl(c));return u(s);case"Object"!==e.constructor.name:for(o=Object.keys(e),s=[this.sendLen(t.MAP,o.length)],f=0,p=o.length;p>f;f++)i=o[f],s.push(this.sendImpl(i)),s.push(this.sendImpl(e[i]));return u(s);default:throw"unsupported object in cbor protocol"}},e}(),null})("undefined"!=typeof exports&&null!==exports?exports:this)}).call(this);