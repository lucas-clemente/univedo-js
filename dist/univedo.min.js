!function(a){var b,c,d,e,f,g,h,i;for(d=[],f={},g=i=0;255>=i;g=++i)d[g]=(g+256).toString(16).substr(1),f[d[g]]=g;h=function(a){return g=0,d[a[g++]]+d[a[g++]]+d[a[g++]]+d[a[g++]]+"-"+d[a[g++]]+d[a[g++]]+"-"+d[a[g++]]+d[a[g++]]+"-"+d[a[g++]]+d[a[g++]]+"-"+d[a[g++]]+d[a[g++]]+d[a[g++]]+d[a[g++]]+d[a[g++]]+d[a[g++]]},c=function(a){var b,c,d,e;for(b=new ArrayBuffer(a.length),c=new Uint8Array(b),g=d=0,e=a.length-1;e>=0?e>=d:d>=e;g=e>=0?++d:--d)c[g]=a.charCodeAt(g);return b},b=function(a){return c(String.fromCharCode.apply(null,a))},e=function(a){var b,c,d,e,f,g,h,i;for(e=0,f=0,h=a.length;h>f;f++)b=a[f],e+=b.byteLength;for(d=new Uint8Array(e),c=0,g=0,i=a.length;i>g;g++)b=a[g],d.set(new Uint8Array(b),c),c+=b.byteLength;return d.buffer};var j,k,l,m;j={UINT:0,NEGINT:1,BYTESTRING:2,TEXTSTRING:3,ARRAY:4,MAP:5,TAG:6,SIMPLE:7},l={DATETIME:0,TIME:1,DECIMAL:4,REMOTEOBJECT:6,UUID:7,SQL:10},k={FALSE:20,TRUE:21,NULL:22,FLOAT32:26,FLOAT64:27},a.Message=m=function(){function a(a){this.buffer=a,this.offset=0}return a.prototype.getDataView=function(a){var b;return b=new DataView(this.buffer,this.offset,a),this.offset+=a,b},a.prototype.getLen=function(a){var b;switch(b=31&a){case 24:return this.getDataView(1).getUint8(0);case 25:return this.getDataView(2).getUint16(0);case 26:return this.getDataView(4).getUint32(0);case 27:throw"int64 not yet supported in javascript!";default:return b}},a.prototype.read=function(){var a,b,c,d,e,f,g,i,m,n,o;switch(f=this.getDataView(1).getUint8(0),c=f>>5){case j.UINT:return this.getLen(f);case j.NEGINT:return-this.getLen(f)-1;case j.SIMPLE:switch(31&f){case k.FALSE:return!1;case k.TRUE:return!0;case k.NULL:return null;case k.FLOAT32:return this.getDataView(4).getFloat32(0);case k.FLOAT64:return this.getDataView(8).getFloat64(0);default:throw"invalid simple in cbor protocol"}break;case j.BYTESTRING:return b=this.getLen(f),this.buffer.slice(this.offset,this.offset+=b);case j.TEXTSTRING:return b=this.getLen(f),String.fromCharCode.apply(null,new Uint8Array(this.buffer.slice(this.offset,this.offset+=b)));case j.ARRAY:for(b=this.getLen(f),o=[],a=g=0,m=b-1;m>=0?m>=g:g>=m;a=m>=0?++g:--g)o.push(this.read());return o;case j.MAP:for(b=this.getLen(f),d={},a=i=0,n=b-1;n>=0?n>=i:i>=n;a=n>=0?++i:--i)d[this.read()]=this.read();return d;case j.TAG:switch(e=this.getLen(f)){case l.DATETIME:return new Date(this.read());case l.TIME:return new Date(this.read());case l.UUID:return h(this.read());default:throw"invalid tag in cbor protocol"}break;default:throw"invalid major in cbor protocol"}},a.prototype.sendSimple=function(a){return b([j.SIMPLE<<5|a])},a.prototype.sendTag=function(a){return b([j.TAG<<5|a])},a.prototype.sendLen=function(a,c){var d;switch(d=a<<5,!1){case!(23>=c):return b([d|c]);case!(256>c):return b([24|d,c]);case!(65536>c):return b([25|d,c>>8,255&c]);case!(4294967296>c):return b([26|d,c>>24,c>>16,c>>8,255&c]);default:throw"sendLen() called with non-uint"}},a.prototype.sendImpl=function(a){var b,d,f,g,h,i,m,n,o;switch(!1){case null!==a:return this.sendSimple(k.NULL);case a!==!0:return this.sendSimple(k.TRUE);case a!==!1:return this.sendSimple(k.FALSE);case"number"!=typeof a:switch(!1){case!(a>=0&&4294967296>a&&a%1===0):return this.sendLen(j.UINT,a);case!(0>a&&a>=-4294967296&&a%1===0):return this.sendLen(j.NEGINT,-a-1);default:return b=new ArrayBuffer(8),new DataView(b).setFloat64(0,a),e([this.sendSimple(k.FLOAT64),b])}break;case"string"!=typeof a:return e([this.sendLen(j.TEXTSTRING,a.length),c(a)]);case"ArrayBuffer"!==a.constructor.name:return e([this.sendLen(j.BYTESTRING,a.byteLength),a]);case"Array"!==a.constructor.name:for(d=[this.sendLen(j.ARRAY,a.length)],i=0,n=a.length;n>i;i++)h=a[i],d.push(this.sendImpl(h));return e(d);case"Object"!==a.constructor.name:for(g=Object.keys(a),d=[this.sendLen(j.MAP,g.length)],m=0,o=g.length;o>m;m++)f=g[m],d.push(this.sendImpl(f)),d.push(this.sendImpl(a[f]));return e(d);case"Date"!==a.constructor.name:return e([this.sendTag(l.DATETIME),this.sendImpl(a.toISOString())]);default:throw"unsupported object in cbor protocol"}},a}()}("undefined"!=typeof exports&&null!==exports?exports:this);